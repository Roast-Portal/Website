<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Google Apps Script Test</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; }
    .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
    button { padding: 10px 20px; margin: 10px; background: #0071E3; color: white; border: none; border-radius: 4px; cursor: pointer; }
    button:hover { background: #0051A3; }
    .result { margin-top: 10px; padding: 10px; background: #f5f5f5; border-radius: 4px; }
    .success { background: #d4edda; color: #155724; }
    .error { background: #f8d7da; color: #721c24; }
  </style>
</head>
<body>
  <h1>Google Apps Script Integration Test</h1>
  
  <div class="test-section">
    <h3>Test 1: Fetch API Submission</h3>
    <button onclick="testFetchSubmission()">Test Fetch Submission</button>
    <div id="fetch-result" class="result"></div>
  </div>
  
  <div class="test-section">
    <h3>Test 2: Form Submission (Fallback)</h3>
    <button onclick="testFormSubmission()">Test Form Submission</button>
    <div id="form-result" class="result"></div>
  </div>
  
  <div class="test-section">
    <h3>Test 3: Sample Quiz Data</h3>
    <button onclick="testSampleQuizData()">Test Sample Quiz Data</button>
    <div id="sample-result" class="result"></div>
  </div>

  <script>
    const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzisZDtTApkwlIoZBZV0oVxJQWI2EQJTC1e9JS814yNn6w2qF-xY6QKHVaX-1pzoYXbag/exec';
    
    // Sample quiz data similar to what the actual quiz would send
    const sampleQuizData = {
      // Quiz answers
      roastLevel: 'Medium',
      brewMethod: 'Pour-over',
      additions: ['Black', 'Milk / Cream'],
      cupsPerDay: 'More than one cup per day',
      personality: 'Enjoy some variety',
      tasteBalance: 'Sweet & Smooth',
      flavorNutty: '75',
      flavorFruity: '60',
      flavorFloral: '40',
      flavorSmoky: '30',
      priceRange: '20',
      equipmentDetails: 'V60, Chemex',
      additionalNotes: 'Love caramel notes',
      blendName: 'Test Blend',
      firstName: 'Test',
      lastName: 'User',
      email: 'test@example.com',
      
      // Metadata for your Google Apps Script
      source: 'quiz',
      tab: 'FormResponses',
      submission_id: 'test_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
      timestamp: new Date().toISOString(),
      page_path: window.location.pathname,
      referrer: document.referrer || '',
      user_agent: navigator.userAgent,
      
      // UTM parameters (simulated for testing)
      utm_source: 'test_source',
      utm_medium: 'test_medium',
      utm_campaign: 'test_campaign',
      gclid: 'test_gclid'
    };
    
    async function testFetchSubmission() {
      const resultDiv = document.getElementById('fetch-result');
      resultDiv.innerHTML = 'Testing...';
      resultDiv.className = 'result';
      
      try {
        const formData = new FormData();
        
        // Add sample data
        Object.keys(sampleQuizData).forEach(key => {
          if (sampleQuizData[key] !== null && sampleQuizData[key] !== undefined) {
            if (Array.isArray(sampleQuizData[key])) {
              formData.append(key, sampleQuizData[key].join(', '));
            } else {
              formData.append(key, String(sampleQuizData[key]));
            }
          }
        });
        
        const response = await fetch(GOOGLE_SCRIPT_URL, {
          method: 'POST',
          body: formData,
          mode: 'no-cors'
        });
        
        resultDiv.innerHTML = '✅ Fetch submission successful! (Response: ' + response.status + ')';
        resultDiv.className = 'result success';
        console.log('Fetch submission result:', response);
        
      } catch (error) {
        resultDiv.innerHTML = '❌ Fetch submission failed: ' + error.message;
        resultDiv.className = 'result error';
        console.error('Fetch submission error:', error);
      }
    }
    
    function testFormSubmission() {
      const resultDiv = document.getElementById('form-result');
      resultDiv.innerHTML = 'Testing...';
      resultDiv.className = 'result';
      
      try {
        // Create a hidden form and submit it
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = GOOGLE_SCRIPT_URL;
        form.target = '_blank';
        form.style.display = 'none';
        
        // Add sample data
        Object.keys(sampleQuizData).forEach(key => {
          if (sampleQuizData[key] !== null && sampleQuizData[key] !== undefined) {
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = key;
            if (Array.isArray(sampleQuizData[key])) {
              input.value = sampleQuizData[key].join(', ');
            } else {
              input.value = String(sampleQuizData[key]);
            }
            form.appendChild(input);
          }
        });
        
        // Submit the form
        document.body.appendChild(form);
        form.submit();
        document.body.removeChild(form);
        
        resultDiv.innerHTML = '✅ Form submission initiated! Check for new tab/window.';
        resultDiv.className = 'result success';
        console.log('Form submission initiated');
        
      } catch (error) {
        resultDiv.innerHTML = '❌ Form submission failed: ' + error.message;
        resultDiv.className = 'result error';
        console.error('Form submission error:', error);
      }
    }
    
    function testSampleQuizData() {
      const resultDiv = document.getElementById('sample-result');
      resultDiv.innerHTML = '<pre>' + JSON.stringify(sampleQuizData, null, 2) + '</pre>';
      resultDiv.className = 'result';
    }
  </script>
</body>
</html>
