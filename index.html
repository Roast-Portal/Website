<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RoastPortal – Personalized Coffee Quiz | Find Your Perfect Roast</title>

  <!-- ╔═════════════ SEO & Social ═════════════╗ -->
  <meta name="description"  content="Discover your ideal coffee roast with our interactive quiz and personalized recommendations.">
  <meta name="keywords"     content="coffee, roasting, personalized, quiz, beans, brew">
  <meta property="og:title"       content="RoastPortal – Personalized Coffee Quiz | Find Your Perfect Roast">
  <meta property="og:description" content="Take the RoastPortal quiz to get a custom coffee profile crafted just for you">
  <meta property="og:image"       content="https://roastportal.com/images/og-image.jpg">
  <meta property="og:url"         content="https://roastportal.com/">
  <meta name="twitter:card"       content="summary_large_image">
  <meta name="twitter:title"      content="RoastPortal – Personalized Coffee Quiz | Find Your Perfect Roast">
  <meta name="twitter:description"content="Take the RoastPortal quiz to get a custom coffee profile crafted just for you.">
  <meta name="twitter:image"      content="https://roastportal.com/images/og-image.jpg">
  <link rel="canonical" href="https://roastportal.com/">
  <link rel="icon" type="image/png" href="images/favicon.png">

  <!-- ╔═════════════ Fonts & Tailwind ═════════════╗ -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@700;900&display=swap"  rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600&display=swap"     rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@0,400;0,600;0,700;1,600&display=swap" rel="stylesheet">

  <!-- ╔═════════════ Page‑specific CSS ═════════════╗ -->
  <style>
    :root{--brand-dark:#2b1608;--brand-light:#f5f0ea}
    .pill-input input{display:none}
    .pill-input input:checked + span{background:#22c55e;color:#fff;border-color:#22c55e}
    .pill-input label span{transition:.2s;padding:.5rem 1.25rem;border-radius:9999px;border:1px solid #d1d5db;cursor:pointer;display:inline-block}
    .question{display:none;min-height:200px}.question.active{display:block}
    .wordmark{font-family:'Kanit','Poppins','Nunito',sans-serif;font-size:2rem;letter-spacing:.04em;text-transform:uppercase;line-height:1.1}
    .wordmark .roast,.wordmark .portal{color:#2b1608;margin:0;padding:0;display:block}
    html{scroll-padding-top:80px}html,body{font-family:'Kanit','Poppins','Nunito','Playfair Display',sans-serif}
    textarea{font-size:1.15rem;padding:1rem;border:2px solid #d1d5db;border-radius:.75rem;background:#f8fafc;color:#2b1608;transition:border .2s,box-shadow .2s;min-height:4.5rem}
    textarea:focus{border-color:#22c55e;box-shadow:0 0 0 2px #bbf7d0;background:#fff;text-align:center}
    #quizCard{min-height:420px;padding-top:2.5rem;padding-bottom:2.5rem}
    @keyframes fadeInLoadingMsg{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
    .sequential-fade-in{opacity:0;animation:fadeInLoadingMsg .7s ease forwards}
    /* hero gradient animation */
    @keyframes heroGradient{
      0%{background:radial-gradient(circle at 30% 40%,rgba(34,197,94,.10)0%,rgba(43,22,8,.08)100%)}
      25%{background:radial-gradient(circle at 70% 60%,rgba(43,22,8,.12)0%,rgba(34,197,94,.08)100%)}
      50%{background:radial-gradient(circle at 60% 30%,rgba(34,197,94,.09)0%,rgba(43,22,8,.08)100%)}
      75%{background:radial-gradient(circle at 40% 70%,rgba(43,22,8,.10)0%,rgba(34,197,94,.09)100%)}
      100%{background:radial-gradient(circle at 30% 40%,rgba(34,197,94,.10)0%,rgba(43,22,8,.08)100%)}
    }
    .animate-heroGradient{animation:heroGradient 30s ease-in-out infinite;opacity:1}
  </style>
</head>

<body class="font-sans antialiased text-gray-800 bg-gray-50">

<!-- ╔═════════════ HEADER ═════════════╗ -->
<header class="bg-white shadow sticky top-0 z-50">
  <nav class="container mx-auto flex justify-between items-center py-2 px-6 md:py-2 md:px-8" aria-label="Main navigation">
    <a href="#hero" class="flex items-center gap-x-4" aria-label="RoastPortal Home">
      <img src="images/favicon.png" alt="RoastPortal logo" class="h-10" loading="lazy">
      <span class="wordmark"><span class="roast">Roast</span><span class="portal">Portal</span></span>
    </a>
    <a class="text-[#2b1608] font-semibold hover:underline px-4 py-2 rounded transition-colors" href="/login">Login</a>
  </nav>
</header>

<!-- ╔═════════════ HERO ═════════════╗ -->
<section id="hero" class="relative bg-cover bg-center min-h-[60vh] flex items-center justify-center overflow-hidden" style="background-image:url('images/hero-banner.png')">
  <div aria-hidden="true" class="absolute inset-0 bg-gradient-to-b from-[#2b1608]/90 via-black/80 to-black/90"></div>
  <div aria-hidden="true" class="absolute inset-0 animate-heroGradient pointer-events-none"></div>
  <span class="sr-only">Background showing roasted coffee beans and a steaming mug</span>

  <div class="relative z-10 text-center px-6 py-20">
    <h1 class="text-4xl md:text-6xl font-bold text-white drop-shadow mb-4" style="font-family:'Poppins',sans-serif;font-weight:600">
      Data‑driven coffee,<br>roasted for <span class="text-[#22c55e] drop-shadow font-extrabold">you</span>
    </h1>
    <p class="text-lg md:text-2xl text-white mb-6 drop-shadow">
      Answer a few questions, sip, rate, repeat — our AI adapts every bag until it’s perfect for you.
    </p>
    <a class="bg-[#16a34a] text-white px-6 py-3 rounded-full font-medium text-lg hover:bg-[#22c55e] transition-colors" href="#quiz">Take the quiz</a>
  </div>
</section>

<!-- ╔═════════════ HOW IT WORKS ═════════════╗ -->
<section id="how-it-works" class="py-16 bg-gray-100">
  <div class="container mx-auto px-6">
    <h2 class="text-3xl font-bold text-center mb-12">How it works</h2>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-10">
      <article class="text-center p-6 bg-white rounded-lg shadow-lg">
        <div class="text-5xl font-extrabold text-[#2b1608] mb-4">1</div>
        <h3 class="text-xl font-semibold mb-2">Share your taste</h3>
        <p class="text-gray-600 text-base px-4">Tell our AI what you like.</p>
      </article>
      <article class="text-center p-6 bg-white rounded-lg shadow-lg">
        <div class="text-5xl font-extrabold text-[#2b1608] mb-4">2</div>
        <h3 class="text-xl font-semibold mb-2">Enjoy your roast</h3>
        <p class="text-gray-600 text-base px-4">We send a roast crafted just for you.</p>
      </article>
      <article class="text-center p-6 bg-white rounded-lg shadow-lg">
        <div class="text-5xl font-extrabold text-[#2b1608] mb-4">3</div>
        <h3 class="text-xl font-semibold mb-2">Refine your cup</h3>
        <p class="text-gray-600 text-base px-4">Give feedback so the next bag is even better.</p>
      </article>
    </div>
  </div>
</section>

<!-- ╔═════════════ QUIZ ═════════════╗ -->
<section id="quiz" class="py-16 bg-white">
  <div class="container mx-auto px-6">
    <h2 class="text-3xl font-bold text-center mb-8">Train your coffee AI</h2>

    <!-- ▶ FORM 1 : QUIZ ◀ -->
    <form id="quizForm" class="max-w-3xl mx-auto bg-white/90 shadow-xl rounded-2xl p-6 md:p-10" aria-label="Coffee Preference Quiz">
      <input type="hidden" name="formType" value="quiz">
      <input type="hidden" name="userId" id="quizUserId">

      <!-- Progress bar -->
      <div class="mb-6">
        <div class="w-full bg-gray-200 rounded-full h-3">
          <div id="progressBar" class="bg-[#22c55e] h-3 rounded-full transition-all" style="width:0%"></div>
        </div>
      </div>

      <!-- Dynamic question container -->
      <div id="quizCard" class="relative min-h-[220px] flex flex-col justify-center items-center"></div>

      <p id="errorMessage" class="hidden text-red-500 text-sm font-medium mt-2"></p>

      <!-- Navigation buttons -->
      <div class="flex flex-col sm:flex-row justify-between mt-6 gap-2">
        <button id="submitBtn" class="bg-[#22c55e] text-white px-6 py-3 rounded font-semibold hidden" type="submit">Submit</button>
        <div class="flex flex-col sm:flex-row gap-2 sm:ml-auto">
          <button id="nextBtn" class="bg-[#22c55e] text-white px-6 py-3 rounded font-semibold order-2 sm:order-2">Next</button>
          <button id="prevBtn" class="bg-gray-300 text-gray-800 px-6 py-3 rounded font-semibold order-1 sm:order-1" disabled>Previous</button>
        </div>
      </div>
    </form>

    <!-- ▶ FORM 2 : CONTACT ◀ (hidden until quiz completes) -->
    <form id="contactForm" class="space-y-4 max-w-lg mx-auto mt-10 hidden">
      <input type="hidden" name="formType" value="contact">
      <input type="hidden" name="userId" id="contactUserId">
      <div>
        <label class="block font-medium mb-1" for="contactName">Name</label>
        <input class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-200" type="text" id="contactName" name="contactName" required>
      </div>
      <div>
        <label class="block font-medium mb-1" for="contactEmail">Email</label>
        <input class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-200" type="email" id="contactEmail" name="contactEmail" required>
      </div>
      <div>
        <label class="block font-medium mb-1" for="contactPhone">Phone</label>
        <input class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-200" type="tel" id="contactPhone" name="contactPhone" required>
      </div>
      <button class="w-full bg-[#22c55e] text-white font-semibold py-2 rounded hover:bg-[#16a34a] transition" type="submit">Buy Now</button>
      <p id="contactError" class="hidden text-center text-red-500 font-semibold mt-2"></p>
      <p id="contactSuccess" class="hidden text-center text-[#16a34a] font-semibold mt-4">Thank you! We have your details.</p>
    </form>
  </div>
</section>

<!-- ╔═════════════ FAQ (UNCHANGED) ═════════════╗ -->
<section class="container mx-auto px-6 max-w-3xl mt-12 mb-16" aria-label="Frequently Asked Questions">
  <h2 class="text-3xl font-bold text-center mb-8">FAQ</h2>
  <div class="space-y-4">
    <details class="border border-gray-200 rounded-lg p-4">
      <summary class="pl-2 font-semibold cursor-pointer">How does it work?</summary>
      <p class="mt-2 text-gray-600">
        You answer a questionnaire. We send you your first personalized bag of coffee. You try it and give us feedback about that specific bag. We take your feedback and use AI to further improve how we roast coffee for you. Your next bag of coffee is upgraded with the new changes. After you try it, you can give us feedback again and we will continue to improve your coffee until it is perfect for you.
      </p>
    </details>
    <details class="border border-gray-200 rounded-lg p-4">
      <summary class="pl-2 font-semibold cursor-pointer">What makes you different from other coffee subscription services?</summary>
      <p class="mt-2 text-gray-600">
        Other services have a fixed number of coffee blends to choose from and they try to help you find which blend you would like best. We start with what you tell us you are looking for and then create a blend just for you. When you give us feedback on your blend, we tweak your blend just for you. Our goal is to work with you to create the perfect blend for you.
      </p>
    </details>
    <details class="border border-gray-200 rounded-lg p-4">
      <summary class="pl-2 font-semibold cursor-pointer">What is a blend?</summary>
      <p class="mt-2 text-gray-600">
        Other roasters mix one or more types of coffee together that are roasted in a specific way to create a blend that the roaster likes and then sells to a mass market. We believe blends should be personal to each individual. We use the same levers to create a blend, but by using AI, we are able to create a blend that isn’t trying to align with what our personal taste preferences are, but align with your taste preferences.
      </p>
    </details>
    <details class="border border-gray-200 rounded-lg p-4">
      <summary class="pl-2 font-semibold cursor-pointer">What if I want to have more than one blend?</summary>
      <p class="mt-2 text-gray-600">
        That’s easy. Just go into your settings and create a new blend. Any new blend you create will be optimized separately. You can specify how often you want us to send you each blend you have created.
      </p>
    </details>
    <details class="border border-gray-200 rounded-lg p-4">
      <summary class="pl-2 font-semibold cursor-pointer">Do I need to give feedback every time?</summary>
      <p class="mt-2 text-gray-600">
        No. If you don’t give feedback, we send you the same coffee as before.
      </p>
    </details>
    <details class="border border-gray-200 rounded-lg p-4">
      <summary class="pl-2 font-semibold cursor-pointer">How do I pause my subscription?</summary>
      <p class="mt-2 text-gray-600">
        Just turn on “vacation mode” in your settings.
      </p>
    </details>
    <details class="border border-gray-200 rounded-lg p-4">
      <summary class="pl-2 font-semibold cursor-pointer">How often will I get a new bag of coffee?</summary>
      <p class="mt-2 text-gray-600">
        After you open a new bag of coffee and leave feedback, we start creating the next version of your coffee and send it to you when done. We package it to remain fresh until you need it. If you don’t provide any feedback, we estimate when you will be running low on coffee and try to time it so we send you a new bag before you run out.
      </p>
    </details>
    <details class="border border-gray-200 rounded-lg p-4">
      <summary class="pl-2 font-semibold cursor-pointer">How much does the coffee cost?</summary>
      <p class="mt-2 text-gray-600">
        You get to choose how much you pay. Paying more impacts how much we are able to optimize the quality of your coffee.
      </p>
    </details>
    <details class="border border-gray-200 rounded-lg p-4">
      <summary class="pl-2 font-semibold cursor-pointer">What sizes of coffee can I buy?</summary>
      <p class="mt-2 text-gray-600">
        Currently we only sell 12 oz bags of coffee. Please let us know if you would like to buy in bulk: <a class="underline" href="mailto:support@roastportal.com">support@roastportal.com</a>.
      </p>
    </details>
  </div>
</section>

<!-- ╔═════════════ FOOTER ═════════════╗ -->
<footer class="bg-gray-800 text-gray-200 py-8">
  <div class="container mx-auto px-6 flex flex-col md:flex-row justify-between items-center text-sm space-y-4 md:space-y-0">
    <a href="#hero" aria-label="Back to top"><img src="images/favicon.png" alt="RoastPortal logo" class="h-8" loading="lazy"></a>
    <p>© 2025 RoastPortal. All rights reserved.</p>
    <div class="flex space-x-4">
      <a href="terms.html" class="hover:underline">Terms</a>
      <a href="mailto:hello@roastportal.com" class="hover:underline">Contact</a>
    </div>
  </div>
</footer>

<!-- ╔═════════════ MAIN SCRIPT ═════════════╗ -->
<script>
/*------------------------------------------------------------------
  CONFIG
------------------------------------------------------------------*/
const GAS_URL     = 'https://script.google.com/macros/s/AKfycbyN5Mv6iJ7Wmj79jR6TY9PcXgK8-QaaKFSwqq8KRlzaPYidgCr6rcYlLePDqbDDzyNoaQ/exec'; // ← replace with your deployed Web‑App URL
const TAB_FORM    = 'FormResponses';
const TAB_CONTACT = 'ContactCapture';

/*------------------------------------------------------------------
  STATE & HELPERS
------------------------------------------------------------------*/
const quizData = [
  {label:'What roast level do you enjoy most?', type:'radio', name:'roastLevel', options:['Light','Light-Medium','Medium','Medium-Dark','Dark']},
  {label:'Which flavor notes do you love?', type:'multi-range', names:['flavorNutty','flavorFruity','flavorFloral','flavorSmoky'], min:0,max:100,step:1,flavors:['Nutty','Fruity','Floral','Smoky']},
  {label:'How do you usually brew your coffee?', type:'radio', name:'brewMethod', options:['Drip','Pour-over','French Press','Espresso','Single-Serve Pod','Cold Brew','Other']},
  {label:'What brewing equipment do you have?', type:'text', name:'equipmentDetails'},
  {label:'Would you like us to grind the beans?', type:'radio', name:'grindService', options:['Yes','No']},
  {label:'How do you usually take your coffee?', type:'checkbox', names:['addMilk','addDairyFree','addSugar'], options:['Milk / Cream','Dairy‑free Milk','Sugar / Syrup']},
  {label:'What’s your coffee budget?', type:'range', name:'priceRange', min:12, max:100, step:1, left:'$12', right:'$100'},
  {label:'How adventurous is your coffee personality?', type:'range', name:'personality', min:0, max:100, step:1, left:'Comforting', right:'Complex'},
  {label:'Where do you like your flavour balance?', type:'multi-range', names:['tasteSweetBitter','tasteSmoothTart'], min:0,max:100,step:1,flavors:['Sweet ←→ Bitter','Smooth ←→ Tart']},
  {label:'About how many cups do you drink per day?', type:'radio', name:'cupsPerDay', options:['1-2','3-5','6+']},
  {label:'What kind of water do you brew with?', type:'radio', name:'waterType', options:['Unfiltered tap','Filtered tap','Recipe','Distilled']},
  {label:'Anything else we should know?', type:'text', name:'additionalNotes'}
];
const defaults = {roastLevel:'Medium',brewMethod:'Drip',grindService:'No',priceRange:35,personality:50,
  flavorNutty:50,flavorFruity:50,flavorFloral:50,flavorSmoky:50,
  tasteSweetBitter:50,tasteSmoothTart:50,cupsPerDay:'1-2',waterType:'Unfiltered tap'
};

let current = 0;
let answers = {...defaults};
const userId = sessionStorage.getItem('userId') || (crypto.randomUUID?.() || Math.random().toString(36).slice(2));
sessionStorage.setItem('userId', userId);

/*------------------------------------------------------------------
  DOM SHORTCUTS
------------------------------------------------------------------*/
const quizForm      = document.getElementById('quizForm');
const contactForm   = document.getElementById('contactForm');
const quizCard      = document.getElementById('quizCard');
const progressBar   = document.getElementById('progressBar');
const prevBtn       = document.getElementById('prevBtn');
const nextBtn       = document.getElementById('nextBtn');
const submitBtn     = document.getElementById('submitBtn');
const errorMessage  = document.getElementById('errorMessage');
document.getElementById('quizUserId').value    = userId;
document.getElementById('contactUserId').value = userId;

/*------------------------------------------------------------------
  RENDERING
------------------------------------------------------------------*/
function renderQuestion(idx){
  const q = quizData[idx];
  quizCard.innerHTML='';
  if(!q) return;

  /* RADIO */
  if(q.type==='radio'){
    quizCard.innerHTML=`
      <fieldset class="w-full">
        <legend class="block text-xl font-semibold mb-2">${q.label}</legend>
        <div class="flex flex-wrap gap-3 mb-2 pill-input">
          ${q.options.map(opt=>`
            <label><input type="radio" name="${q.name}" value="${opt}" ${answers[q.name]===opt?'checked':''} class="sr-only">
              <span class="${answers[q.name]===opt?'bg-[#22c55e] text-white border-[#22c55e] shadow-md':'bg-white text-gray-800 border-gray-300 hover:bg-gray-100'}">${opt}</span>
            </label>`).join('')}
        </div>
      </fieldset>`;
  }

  /* RANGE */
  else if(q.type==='range'){
    const v = answers[q.name]??q.min;
    quizCard.innerHTML=`
      <label class="block font-semibold text-lg mb-2">${q.label}</label>
      <input type="range" id="${q.name}" name="${q.name}" min="${q.min}" max="${q.max}" step="${q.step}" value="${v}" class="w-full accent-[#22c55e] mb-2">
      <div class="flex justify-between text-sm text-gray-500 mb-2"><span>${q.left||''}</span><span>${q.right||''}</span></div>
      <p class="text-center font-semibold" id="${q.name}Val">${q.name==='priceRange'?'$'+v:v}</p>`;
  }

  /* MULTI‑RANGE */
  else if(q.type==='multi-range'){
    quizCard.innerHTML=`
      <label class="block font-semibold text-lg mb-4">${q.label}</label>
      <div class="space-y-6">${q.names.map((n,i)=>`
        <div>
          <p class="mb-1 text-sm">${q.flavors[i]}</p>
          <input type="range" id="${n}" name="${n}" min="${q.min}" max="${q.max}" step="${q.step}" value="${answers[n]??50}" class="w-full accent-[#22c55e]">
        </div>`).join('')}</div>`;
  }

  /* CHECKBOX */
  else if(q.type==='checkbox'){
    quizCard.innerHTML=`
      <label class="block font-semibold text-lg mb-2">${q.label}</label>
      <div class="flex flex-wrap gap-3 pill-input">
        ${q.options.map((opt,i)=>`
          <label><input type="checkbox" name="${q.names[i]}" ${answers[q.names[i]]?'checked':''}>
            <span>${opt}</span></label>`).join('')}
      </div>`;
  }

  /* TEXT */
  else if(q.type==='text'){
    quizCard.innerHTML=`
      <label class="block font-semibold text-lg mb-2">${q.label}</label>
      <textarea id="${q.name}" name="${q.name}" class="w-full mt-2">${answers[q.name]||''}</textarea>`;
  }

  /* Listeners for newly added controls */
  quizCard.querySelectorAll('input,textarea').forEach(el=>{
    el.addEventListener('input', e=>{
      if(el.type==='checkbox'){answers[el.name]=el.checked}
      else{answers[el.name]=el.value}
      if(el.type==='radio'){autoNext()}
      if(q.type==='range'){
        document.getElementById(el.id+'Val').innerText=q.name==='priceRange'?'$'+el.value:el.value;
      }
    });
  });
}

/*------------------------------------------------------------------
  NAVIGATION
------------------------------------------------------------------*/
function autoNext(){
  if(current<quizData.length-1){current++;updateUI()}
}
function updateUI(){
  renderQuestion(current);
  progressBar.style.width=((current+1)/quizData.length)*100+'%';
  prevBtn.disabled=current===0;
  submitBtn.classList.toggle('hidden',current!==quizData.length-1);
  nextBtn.classList.toggle('hidden',current===quizData.length-1);
}
prevBtn.addEventListener('click',()=>{if(current>0){current--;updateUI()}});
nextBtn.addEventListener('click',()=>{if(current<quizData.length-1){current++;updateUI()}});
updateUI(); // initial render

/*------------------------------------------------------------------
  BACK‑END COMM
------------------------------------------------------------------*/
function submitToSheet(tab, formData){
  return fetch(`${GAS_URL}?tab=${encodeURIComponent(tab)}`,{
    method:'POST',
    mode:'cors',
    headers:{'Accept':'application/json'},
    body:formData
  })
  .then(r=>r.json())
  .catch(()=>({status:'ERR'}));
}

/* QUIZ SUBMIT -----------------------------------------------------*/
quizForm.addEventListener('submit',async e=>{
  e.preventDefault();
  
  const submitButton = document.getElementById('submitBtn');
  const originalButtonHTML = submitButton.innerHTML;
  submitButton.disabled = true;
  submitButton.innerHTML = `
    <span class="inline-flex items-center">
      <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
      Submitting...
    </span>`;
  errorMessage.classList.add('hidden');

  /* inject every answer as hidden input so formData carries them */
  Object.entries(answers).forEach(([k,v])=>{
    const hidden=document.createElement('input');
    hidden.type='hidden';hidden.name=k;hidden.value=(typeof v==='boolean'?v?1:'':v);
    quizForm.appendChild(hidden);
  });
  const fd=new FormData(quizForm); fd.set('userId',userId);
  const res=await submitToSheet(TAB_FORM,fd);
  if(res.status==='OK'){
    quizForm.classList.add('hidden');
    contactForm.classList.remove('hidden');
    window.scrollTo({top:contactForm.offsetTop,behavior:'smooth'});
  }else{
    errorMessage.textContent='Submission failed. Please retry.';
    errorMessage.classList.remove('hidden');
    submitButton.disabled = false;
    submitButton.innerHTML = originalButtonHTML;
  }
});

/* CONTACT SUBMIT --------------------------------------------------*/
contactForm.addEventListener('submit',async e=>{
  e.preventDefault();

  const submitButton = contactForm.querySelector('button[type="submit"]');
  const originalButtonHTML = submitButton.innerHTML;
  submitButton.disabled = true;
  submitButton.innerHTML = `
    <span class="inline-flex items-center justify-center">
      <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
      Submitting...
    </span>`;
  document.getElementById('contactError').classList.add('hidden');

  const fd=new FormData(contactForm); fd.set('userId',userId);
  const res=await submitToSheet(TAB_CONTACT,fd);
  if(res.status==='OK'){
    submitButton.innerHTML = 'Submitted!';
    document.getElementById('contactSuccess').classList.remove('hidden');
    sessionStorage.removeItem('userId');
  }else{
    const contactError = document.getElementById('contactError');
    contactError.textContent = 'Submission failed. Please try again.';
    contactError.classList.remove('hidden');
    submitButton.disabled = false;
    submitButton.innerHTML = originalButtonHTML;
  }
});
</script>
<script>
/* --- SAFETY GUARD: prevent premature submit -------------------------------- */
(function () {
  /* 1. Ensure navigation buttons are not accidental submits */
  ['nextBtn', 'prevBtn'].forEach(id => {
    const btn = document.getElementById(id);
    if (btn && btn.type !== 'button') btn.type = 'button';
  });

  /* 2. Block the ENTER key from submitting while quiz is in progress */
  const qForm = document.getElementById('quizForm');
  if (qForm) qForm.addEventListener('keydown', e => {
    if (e.key === 'Enter') e.preventDefault();
  });
})();
</script>
</body>
</html>
